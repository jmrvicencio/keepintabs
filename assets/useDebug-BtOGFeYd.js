import{e as ee,r as O}from"./index--mqDWwSn.js";const I={},Y=(e,n)=>e.unstable_is?e.unstable_is(n):n===e,Z=e=>"init"in e,G=e=>!!e.write,F=e=>"v"in e||"e"in e,N=e=>{if("e"in e)throw e.e;if((I?"production":void 0)!=="production"&&!("v"in e))throw new Error("[Bug] atom state is not initialized");return e.v},j=new WeakMap,B=e=>{var n;return U(e)&&!!((n=j.get(e))!=null&&n[0])},ie=e=>{const n=j.get(e);n?.[0]&&(n[0]=!1,n[1].forEach(r=>r()))},te=(e,n)=>{let r=j.get(e);if(!r){r=[!0,new Set],j.set(e,r);const l=()=>{r[0]=!1};e.then(l,l)}r[1].add(n)},U=e=>typeof e?.then=="function",ne=(e,n,r)=>{r.p.has(e)||(r.p.add(e),n.then(()=>{r.p.delete(e)},()=>{r.p.delete(e)}))},K=(e,n,r)=>{const l=r(e),f="v"in l,d=l.v;if(U(n))for(const h of l.d.keys())ne(e,n,r(h));l.v=n,delete l.e,(!f||!Object.is(d,l.v))&&(++l.n,U(d)&&ie(d))},k=(e,n,r)=>{var l;const f=new Set;for(const d of((l=r.get(e))==null?void 0:l.t)||[])r.has(d)&&f.add(d);for(const d of n.p)f.add(d);return f},ce=Symbol(),le=(e=new WeakMap,n=new WeakMap,r=new WeakMap,l=new Set,f=new Set,d=new Set,h={},A=(v,...y)=>v.read(...y),E=(v,...y)=>v.write(...y),a=(v,y)=>{var b;return(b=v.unstable_onInit)==null?void 0:b.call(v,y)},S=(v,y)=>{var b;return(b=v.onMount)==null?void 0:b.call(v,y)},...p)=>{const v=p[0]||(t=>{if((I?"production":void 0)!=="production"&&!t)throw new Error("Atom is undefined or null");let u=e.get(t);return u||(u={d:new Map,p:new Set,n:0},e.set(t,u),a?.(t,$)),u}),y=p[1]||(()=>{const t=[],u=c=>{try{c()}catch(s){t.push(s)}};do{h.f&&u(h.f);const c=new Set,s=c.add.bind(c);l.forEach(o=>{var i;return(i=n.get(o))==null?void 0:i.l.forEach(s)}),l.clear(),d.forEach(s),d.clear(),f.forEach(s),f.clear(),c.forEach(u),l.size&&b()}while(l.size||d.size||f.size);if(t.length)throw new AggregateError(t)}),b=p[2]||(()=>{const t=[],u=new WeakSet,c=new WeakSet,s=Array.from(l);for(;s.length;){const o=s[s.length-1],i=v(o);if(c.has(o)){s.pop();continue}if(u.has(o)){if(r.get(o)===i.n)t.push([o,i]);else if((I?"production":void 0)!=="production"&&r.has(o))throw new Error("[Bug] invalidated atom exists");c.add(o),s.pop();continue}u.add(o);for(const w of k(o,i,n))u.has(w)||s.push(w)}for(let o=t.length-1;o>=0;--o){const[i,w]=t[o];let g=!1;for(const T of w.d.keys())if(T!==i&&l.has(T)){g=!0;break}g&&(P(i),L(i)),r.delete(i)}}),P=p[3]||(t=>{var u;const c=v(t);if(F(c)&&(n.has(t)&&r.get(t)!==c.n||Array.from(c.d).every(([_,z])=>P(_).n===z)))return c;c.d.clear();let s=!0;const o=()=>{n.has(t)&&(L(t),b(),y())},i=_=>{var z;if(Y(t,_)){const X=v(_);if(!F(X))if(Z(_))K(_,_.init,v);else throw new Error("no atom init");return N(X)}const C=P(_);try{return N(C)}finally{c.d.set(_,C.n),B(c.v)&&ne(t,c.v,C),(z=n.get(_))==null||z.t.add(t),s||o()}};let w,g;const T={get signal(){return w||(w=new AbortController),w.signal},get setSelf(){return(I?"production":void 0)!=="production"&&!G(t)&&console.warn("setSelf function cannot be used with read-only atom"),!g&&G(t)&&(g=(..._)=>{if((I?"production":void 0)!=="production"&&s&&console.warn("setSelf function cannot be called in sync"),!s)try{return D(t,..._)}finally{b(),y()}}),g}},x=c.n;try{const _=A(t,i,T);return K(t,_,v),U(_)&&(te(_,()=>w?.abort()),_.then(o,o)),c}catch(_){return delete c.v,c.e=_,++c.n,c}finally{s=!1,x!==c.n&&r.get(t)===x&&(r.set(t,c.n),l.add(t),(u=h.c)==null||u.call(h,t))}}),J=p[4]||(t=>{const u=[t];for(;u.length;){const c=u.pop(),s=v(c);for(const o of k(c,s,n)){const i=v(o);r.set(o,i.n),u.push(o)}}}),D=p[5]||((t,...u)=>{let c=!0;const s=i=>N(P(i)),o=(i,...w)=>{var g;const T=v(i);try{if(Y(t,i)){if(!Z(i))throw new Error("atom not writable");const x=T.n,_=w[0];K(i,_,v),L(i),x!==T.n&&(l.add(i),(g=h.c)==null||g.call(h,i),J(i));return}else return D(i,...w)}finally{c||(b(),y())}};try{return E(t,s,o,...u)}finally{c=!1}}),L=p[6]||(t=>{var u;const c=v(t),s=n.get(t);if(s&&!B(c.v)){for(const[o,i]of c.d)if(!s.d.has(o)){const w=v(o);V(o).t.add(t),s.d.add(o),i!==w.n&&(l.add(o),(u=h.c)==null||u.call(h,o),J(o))}for(const o of s.d||[])if(!c.d.has(o)){s.d.delete(o);const i=W(o);i?.t.delete(t)}}}),V=p[7]||(t=>{var u;const c=v(t);let s=n.get(t);if(!s){P(t);for(const o of c.d.keys())V(o).t.add(t);if(s={l:new Set,d:new Set(c.d.keys()),t:new Set},n.set(t,s),(u=h.m)==null||u.call(h,t),G(t)){const o=()=>{let i=!0;const w=(...g)=>{try{return D(t,...g)}finally{i||(b(),y())}};try{const g=S(t,w);g&&(s.u=()=>{i=!0;try{g()}finally{i=!1}})}finally{i=!1}};f.add(o)}}return s}),W=p[8]||(t=>{var u;const c=v(t);let s=n.get(t);if(s&&!s.l.size&&!Array.from(s.t).some(o=>{var i;return(i=n.get(o))==null?void 0:i.d.has(t)})){s.u&&d.add(s.u),s=void 0,n.delete(t),(u=h.u)==null||u.call(h,t);for(const o of c.d.keys()){const i=W(o);i?.t.delete(t)}return}return s}),se=[e,n,r,l,f,d,h,A,E,a,S,v,y,b,P,J,D,L,V,W],$={get:t=>N(P(t)),set:(t,...u)=>{try{return D(t,...u)}finally{b(),y()}},sub:(t,u)=>{const s=V(t).l;return s.add(u),y(),()=>{s.delete(u),W(t),y()}}};return Object.defineProperty($,ce,{value:se}),$},ue=le,H=te,re={};let fe=0;function de(e,n){const r=`atom${++fe}`,l={toString(){return(re?"production":void 0)!=="production"&&this.debugLabel?r+":"+this.debugLabel:r}};return typeof e=="function"?l.read=e:(l.init=e,l.read=ae,l.write=ve),l}function ae(e){return e(this)}function ve(e,n,r){return n(this,typeof r=="function"?r(e(this)):r)}function he(){return ue()}let R;function _e(){return R||(R=he(),(re?"production":void 0)!=="production"&&(globalThis.__JOTAI_DEFAULT_STORE__||(globalThis.__JOTAI_DEFAULT_STORE__=R),globalThis.__JOTAI_DEFAULT_STORE__!==R&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"))),R}const we={},Se=O.createContext(void 0);function oe(e){return O.useContext(Se)||_e()}const q=e=>typeof e?.then=="function",Q=e=>{e.status||(e.status="pending",e.then(n=>{e.status="fulfilled",e.value=n},n=>{e.status="rejected",e.reason=n}))},pe=ee.use||(e=>{if(e.status==="pending")throw e;if(e.status==="fulfilled")return e.value;throw e.status==="rejected"?e.reason:(Q(e),e)}),M=new WeakMap,m=(e,n)=>{let r=M.get(e);return r||(r=new Promise((l,f)=>{let d=e;const h=a=>S=>{d===a&&l(S)},A=a=>S=>{d===a&&f(S)},E=()=>{try{const a=n();q(a)?(M.set(a,r),d=a,a.then(h(a),A(a)),H(a,E)):l(a)}catch(a){f(a)}};e.then(h(e),A(e)),H(e,E)}),M.set(e,r)),r};function ye(e,n){const{delay:r,unstable_promiseStatus:l=!ee.use}={},f=oe(),[[d,h,A],E]=O.useReducer(S=>{const p=f.get(e);return Object.is(S[0],p)&&S[1]===f&&S[2]===e?S:[p,f,e]},void 0,()=>[f.get(e),f,e]);let a=d;if((h!==f||A!==e)&&(E(),a=f.get(e)),O.useEffect(()=>{const S=f.sub(e,()=>{if(l)try{const p=f.get(e);q(p)&&Q(m(p,()=>f.get(e)))}catch{}if(typeof r=="number"){setTimeout(E,r);return}E()});return E(),S},[f,e,r,l]),O.useDebugValue(a),q(a)){const S=m(a,()=>f.get(e));return l&&Q(S),pe(S)}return a}function ge(e,n){const r=oe();return O.useCallback((...f)=>{if((we?"production":void 0)!=="production"&&!("write"in e))throw new Error("not writable atom");return r.set(e,...f)},[r,e])}function be(e,n){return[ye(e),ge(e)]}const Ee=de({}),Pe=()=>{const[e,n]=be(Ee);return{options:e,addOption:(f,d)=>{n(h=>({...h,[f]:d}))},removeOption:f=>{n(d=>{const{[f]:h,...A}=d;return A})}}};export{de as a,Pe as b,be as u};
