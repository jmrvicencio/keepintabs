import{u as N,r as a,d as C,b as P,R as j,z as O,j as e,a as M,e as G}from"./index-D63cc4uB.js";import{q as A,x as D}from"./firebase-wjis4Syq.js";import{M as S,P as U}from"./mainArea-FTWU3UJ5.js";import{a as I}from"./debuggerFunctions-yaRneN6k.js";import{P as i}from"./Panel-DVkFA_N1.js";import{U as g}from"./UserIcon-BP-Jm84h.js";import{u as Y}from"./usePopupOverlay-Be4litxu.js";import{P as R}from"./plus-DxiqG4FC.js";import{c as w}from"./createLucideIcon-YKtzb1R1.js";import{u as E}from"./useDebug-BhBm4-hj.js";import"./react-gH-7aFTg.js";/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],L=w("arrow-left",T);/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=[["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 18h16",key:"19g7jn"}],["path",{d:"M4 6h16",key:"1o0s65"}]],z=w("menu",_),B=(t="")=>{const s=N(),[r,l]=a.useState(null),[o,n]=a.useState(null),[c,m]=a.useState(),[d,f]=a.useState(!1);let u;return a.useEffect(()=>((async()=>{const y=A(C,"groups",t);if(!d)try{console.log("subscribing to snapshot"),u=D(y,x=>{l(x);const p=x.data(),k=Object.entries(p.members);for(const[b,v]of k){const h=v;if(h.linkedUid==P.currentUser.uid){h.groupUid=b,n(h),m(b);break}}},x=>{u(),console.error(x),s(j.APP)})}catch(x){const p=x;throw O.error(p.message),x}})(),()=>{console.log("ubsubscribing to snapshot"),f(!0)}),[]),{group:r,userData:o,userGroupId:c}};function F(t,s,r){return Math.min(Math.max(t,s),r)}function $(t){if(!t||!t.balance)return{};const s={},r={};for(let[l,o]of Object.entries(t.balance))for(let[n,c]of Object.entries(o))s[n]=(s[n]??0)-c,s[l]=(s[l]??0)+c;for(let l of Object.keys(s)){r[l]=r[l]??{};for(let o of Object.keys(s))if(r[o]=r[o]??{},l!=o&&s[l]<0&&s[o]>0){const n=F(-s[l],0,s[o]);r[l][o]=-n,r[o][l]=n,s[l]+=n,s[o]-=n}}return r}function q(t,s){return!t||!s||!s[t]?0:Object.values(s[t]).reduce((r,l)=>r+l,0)}const ae=a.memo(function(){const s=N();a.memo(()=>e.jsx(R,{}));const{group:r}=M(),{group:l,userGroupId:o}=B(r),n=l?.data(),c=a.useRef(null);c.current?.getBoundingClientRect(),E(S);const m=a.useMemo(()=>$(l?.data()),[l]),d={total:q(o,m),records:m};return I(),a.useCallback(async()=>{console.log("param: ",r),s(`${j.NEW_TRANSACTION}${r&&"?g="+r}`)},[]),e.jsx(e.Fragment,{children:e.jsx("div",{className:"relative flex shrink-0 grow flex-col pt-3",children:e.jsxs("main",{className:"flex h-full flex-col items-stretch",children:[e.jsx(H,{userBalance:d,groupData:n,userGroupUid:o,ref:c}),e.jsxs("section",{className:"font-outfit flex h-full flex-col rounded-t-3xl px-3",children:[e.jsxs("div",{className:"text-leather-900 my-6 flex w-full flex-row items-baseline justify-between px-3",children:[e.jsxs("h2",{className:"text-2xl",children:["August ",e.jsx("span",{className:"font-bold",children:"2024"})]}),e.jsx("p",{children:"2 Transactions"})]}),e.jsxs("div",{className:"flex flex-col gap-2 pb-24",children:[e.jsxs(i,{className:"justfiy-center flex flex-row gap-3",dropOnClick:!0,children:[e.jsxs("div",{className:"bg-accent-200 text-ink-800 flex w-10 flex-col justify-center gap-0 rounded-lg",children:[e.jsx("p",{className:"text-base/4",children:"Aug"}),e.jsx("p",{className:"text-2xl font-bold",children:"25"})]}),e.jsxs("div",{className:"text-charcoal-800 flex grow flex-col gap-1 text-left",children:[e.jsx("h3",{className:"text-leater text-lg/snug font-medium",children:"Mendokoro"}),e.jsx("p",{className:"text-sm/snug font-light",children:"You paid Php 2,000"}),e.jsx("div",{children:e.jsx("p",{className:"border-shell-300 w-fit rounded-lg border px-1 py-0.5 text-sm/tight font-light",children:"Gcash"})})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("p",{className:"text-charcoal-600 font-medium",children:"Php 2,000"}),e.jsxs("p",{className:"mb-2 flex flex-row items-center justify-end gap-1 text-sm font-light",children:["You lent",e.jsx("span",{className:"bg-positive-500 h-2 w-2 rounded-full"})]}),e.jsx(i,{padding:"py-0 px-4",bgColor:"bg-accent-200",rounded:"rounded-lg",dropOnClick:!0,children:e.jsx("p",{className:"text-sm font-normal",children:"Details"})})]})]}),e.jsxs(i,{className:"justfiy-center flex flex-row gap-3",dropOnClick:!0,children:[e.jsxs("div",{className:"bg-accent-200 text-ink-800 flex w-10 flex-col justify-center gap-0 rounded-lg",children:[e.jsx("p",{className:"text-base/4",children:"Aug"}),e.jsx("p",{className:"text-2xl font-bold",children:"25"})]}),e.jsxs("div",{className:"text-charcoal-800 flex grow flex-col gap-1 text-left",children:[e.jsx("h3",{className:"text-leater text-lg/snug font-medium",children:"Mendokoro"}),e.jsx("p",{className:"text-sm/snug font-light",children:"You paid Php 2,000"}),e.jsx("div",{children:e.jsx("p",{className:"border-shell-300 w-fit rounded-lg border px-1 py-0.5 text-sm/tight font-light",children:"Gcash"})})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("p",{className:"text-charcoal-600 font-medium",children:"Php 2,000"}),e.jsxs("p",{className:"mb-2 flex flex-row items-center justify-end gap-1 text-sm font-light",children:["You lent",e.jsx("span",{className:"bg-positive-500 h-2 w-2 rounded-full"})]}),e.jsx(i,{padding:"py-0 px-4",bgColor:"bg-accent-200",rounded:"rounded-lg",dropOnClick:!0,children:e.jsx("p",{className:"text-sm font-normal",children:"Details"})})]})]}),e.jsxs(i,{className:"justfiy-center flex flex-row gap-3",dropOnClick:!0,children:[e.jsxs("div",{className:"bg-accent-200 text-ink-800 flex w-10 flex-col justify-center gap-0 rounded-lg",children:[e.jsx("p",{className:"text-base/4",children:"Aug"}),e.jsx("p",{className:"text-2xl font-bold",children:"25"})]}),e.jsxs("div",{className:"text-charcoal-800 flex grow flex-col gap-1 text-left",children:[e.jsx("h3",{className:"text-leater text-lg/snug font-medium",children:"Mendokoro"}),e.jsx("p",{className:"text-sm/snug font-light",children:"You paid Php 2,000"}),e.jsx("div",{children:e.jsx("p",{className:"border-shell-300 w-fit rounded-lg border px-1 py-0.5 text-sm/tight font-light",children:"Gcash"})})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("p",{className:"text-charcoal-600 font-medium",children:"Php 2,000"}),e.jsxs("p",{className:"mb-2 flex flex-row items-center justify-end gap-1 text-sm font-light",children:["You lent",e.jsx("span",{className:"bg-positive-500 h-2 w-2 rounded-full"})]}),e.jsx(i,{padding:"py-0 px-4",bgColor:"bg-accent-200",rounded:"rounded-lg",dropOnClick:!0,children:e.jsx("p",{className:"text-sm font-normal",children:"Details"})})]})]})]})]})]})})})}),H=({userBalance:t,groupData:s,userGroupUid:r,ref:l})=>{const{setShowPopup:o,setPopup:n}=Y(),c=a.useCallback(()=>{n({type:"menu",options:[],reference:l}),o(!0)},[]),m=a.memo(()=>e.jsx(z,{onClick:c,className:"w-8 cursor-pointer"}));return e.jsxs("section",{className:"border-wheat-400 mx-3 flex grow flex-col items-start gap-2 border-b border-dashed pb-8",children:[e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"text-ink-800 pointer-cursor mb-4 flex flex-row items-center justify-between gap-2 text-lg font-normal",children:[e.jsx(G,{to:j.APP,children:e.jsx(i,{bgColor:"bg-accent-200",dropOnClick:!0,children:e.jsx(L,{className:"text-ink-800"})})}),e.jsxs("div",{className:"border-wheat-400 bg-wheat-200 flex flex-row items-center gap-2 rounded-full border px-2 py-1",children:[e.jsx("p",{className:"ml-1",children:Object.keys(s?.members??{}).length}),e.jsxs("div",{className:"flex flex-row",children:[e.jsx(g,{bgColor:"bg-wheat-400",border:"border-wheat-200"}),e.jsx(g,{bgColor:"bg-wheat-400",border:"border-wheat-200"}),e.jsx(g,{bgColor:"bg-wheat-400",border:"border-wheat-200"})]})]})]}),e.jsxs("div",{className:"mb-4 flex w-full flex-row items-center justify-between",ref:l,children:[e.jsx("h1",{className:"font-gieonto text-left text-4xl font-medium",children:s?.name}),e.jsx("div",{className:"p1 border-wheat-400 flex h-8 w-8 items-center justify-center rounded-lg border",children:e.jsx(m,{})})]}),e.jsx(W,{total:t.total})]}),t?.total!=0&&t?.total!=null&&e.jsx(i,{padding:"px-4 py-2",children:Object.entries(t.records[r??""]).map(([d,f])=>{const u=s?.members[d].displayName??"unkown";return e.jsx(J,{name:u,amt:f},d)})}),e.jsx("p",{className:"text-xs opacity-72",children:"Debts are being simplified"}),e.jsx("div",{className:"border-wheat-400 cursor-pointer rounded-xl border px-3 py-1",children:"See full breakdown"})]})},W=({total:t})=>e.jsx("h2",{className:"font-outfit w-fit text-xl font-light",children:t?e.jsxs(e.Fragment,{children:[t>0?"You are owed":"You owe",e.jsxs("span",{className:"font-bold",children:[" Php ",Math.abs(t)]})]}):"debts clear"}),J=({name:t,amt:s})=>s<0?e.jsxs("p",{className:"text-left",children:["You owe ",t," ",e.jsxs("span",{className:"font-outfit text-negative-500 font-bold",children:["Php ",Math.abs(s)]})]}):e.jsxs("p",{className:"text-left",children:[t," owes you ",e.jsxs("span",{className:"font-outfit text-positive-500 font-bold",children:["Php ",Math.abs(s)]})]});a.memo(({onClick:t,children:s})=>e.jsx("div",{className:"fixed bottom-6 left-1/2 z-5 w-fit -translate-x-1/2",children:e.jsx(U,{className:"flex flex-row text-white",bgColor:"bg-accent-600",dropOnClick:!0,children:s})}));export{ae as default};
