import{d as S,u as B,r as n,a as F,j as e,f as K,L as P,R as U}from"./index--mqDWwSn.js";import{S as T}from"./SmallButton-CSEgtKcI.js";import{q as k,u as M,K as q,I as A,M as L}from"./firebase-D57XAA0E.js";import{v as E}from"./v4-BKrj-4V8.js";import{c as R}from"./createLucideIcon-BtrpMuvF.js";import"./react-gH-7aFTg.js";/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],O=R("chevron-left",z);/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]],H=R("user-round",X);/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Q=R("x",J),W=p=>async(N,x)=>{try{const a=E(),o=p.uid,i=E(),u=k(S,`groups/${a}`),m=k(S,`groupMembers/${o}_${a}`),r=k(S,`groupSettings/${a}`),d={};for(let s of x){const b=E();d[b]=s}M(r,{inviteKey:i}),M(u,{createdAt:q(),inviteKey:i,name:N,memberUids:[o],members:{...d,[o]:{displayName:"Kyle",linkedUid:o}}}),A(u,{inviteKey:L()}),await M(m,{userId:o,groupId:a,inviteKey:i}),await A(m,{inviteKey:L()});return}catch(a){throw a}},oe=()=>{const p=B(),[l,N]=n.useState(""),[x,a]=n.useState(!1),[o,i]=n.useState(""),[u,m]=n.useState(""),[r,d]=n.useState([]),[s,b]=n.useState(!1),j=n.useRef(null),f=n.useRef(null),w=W(F.currentUser),g=async()=>{if(l==""){a(!0);return}s||(b(!0),await w(l,r),p(U.APP))},h=t=>{t.preventDefault(),g()},v=t=>{const c=t.target.value;N(c),a(c==="")},y=t=>{i(t.target.value)},V=t=>{m(t.target.value),f.current?.setCustomValidity("")},D=t=>{console.log("form enter"),t.preventDefault(),console.log("submitting form"),G()},G=()=>{const t={displayName:o};if(u!=""){if(I(u).length>0){f.current?.setCustomValidity("This email is already being used by another member"),f.current?.reportValidity(),f.current?.focus();return}t.email=u}d(c=>[...c,t]),m(""),i("")},_=t=>{const c=r.filter(C=>C.displayName!=t);d(c)},I=(t,c=-1)=>r.filter((C,$)=>C.email!=""&&C.email?.toLowerCase()===t.toLowerCase()&&c!=$);return s?e.jsx(K,{}):e.jsx("div",{className:"relative flex w-dvw shrink-0 flex-col gap-8 p-3",children:e.jsxs("main",{className:"flex w-full flex-col",children:[e.jsxs("div",{className:"relative mb-4 w-full",children:[e.jsx(P,{to:U.APP,className:"absolute left-0 cursor-pointer",children:e.jsxs("p",{className:"text-accent-200 flex flex-row",children:[e.jsx(O,{}),"Cancel"]})}),e.jsx("div",{className:"absolute right-0 cursor-pointer",onClick:g,children:e.jsx("p",{className:"text-accent-200 flex flex-row",children:"Done"})}),e.jsx("h1",{className:"font-medium",children:"Create Group"})]}),e.jsx("form",{onSubmit:h,children:e.jsxs("div",{className:"relative mx-2",children:[e.jsxs("div",{className:"text-cream/70 flex items-baseline justify-between py-2",children:[e.jsx("label",{htmlFor:"name",children:"Group Name"}),e.jsxs("p",{className:"text-xs",children:[l.length,"/32"]})]}),e.jsx("input",{id:"name",type:"text",autoComplete:"off",className:`${x&&"error"} peer [.error]:border-error border-charcoal-300 bg-charcoal-300/20 focus:outline-accent-400/60 [.error]:placeholder:text-error w-full rounded-md border-1 px-2 py-1 focus:outline-2`,placeholder:x?"Group name is required":"Group Name",maxLength:32,value:l,onChange:v,autoFocus:!0})]})}),e.jsxs("div",{className:"relative m-4 mx-2 pt-2 text-left",children:[e.jsx("h2",{className:"font-bold",children:"Add Members"}),e.jsx("p",{className:"text-cream/70 mb-2 text-sm",children:"User will get a notification if the account exists"}),e.jsxs("form",{method:"submit",onSubmit:D,autoComplete:"off",className:"flex flex-col gap-2",ref:j,children:[e.jsxs("div",{className:"flex flex-row gap-2",children:[e.jsx("input",{id:"name",type:"text",className:"border-charcoal-300 bg-charcoal-300/20 focus:outline-accent-400/60 w-0 grow-2 rounded-md border-1 px-2 py-1 focus:outline-2",placeholder:"Name",value:o,onChange:y}),e.jsx("input",{id:"email",ref:f,type:"email",className:"border-charcoal-300 bg-charcoal-300/20 focus:outline-accent-400/60 w-0 grow-3 rounded-md border-1 px-2 py-1 not-focus:invalid:border-red-500 focus:outline-2",placeholder:"Email (optional)",value:u,onChange:V,required:!1})]}),e.jsx("button",{style:{display:"none"},type:"submit"}),e.jsx(T,{inactive:o=="",onClick:G,children:"Add Member"})]}),r.length>0&&e.jsx("div",{className:"border-charcoal-300 mt-6 rounded-lg border-1 p-2",children:r.map((t,c)=>e.jsx(Y,{id:c,member:t,onClick:()=>{_(t.displayName)},setMembers:d,findMembers:I},c))})]})]})})},Y=({id:p,member:l,onClick:N,setMembers:x,findMembers:a})=>{const[o,i]=n.useState(!1),[u,m]=n.useState(!1),[r,d]=n.useState(""),s=n.useRef(null),b=()=>{i(!1),f()},j=()=>{if(s.current?.setCustomValidity(""),s.current?.validity.valid==!1){s.current?.reportValidity(),s.current?.focus();return}else if(a(r,p).length>0){s.current?.setCustomValidity("This email is already being used by another member"),s.current?.reportValidity(),s.current?.focus();return}i(!1),m(!1),f()},f=()=>{x(h=>{const v=[...h],y={...v[p]};return v[p]=y,o?y.displayName=r:y.email=r,v})},w=h=>{h.preventDefault(),u?j():b()},g=h=>{s.current?.setCustomValidity(""),d(h.target.value)};return e.jsxs("div",{className:"border-charcoal-300/30 flex flex-row items-center gap-3 not-first:mt-2 not-first:border-t-1 not-first:pt-4",children:[e.jsx(H,{className:"text-cream/60 h-5 w-5"}),e.jsxs("div",{className:"flex grow-1 flex-col",children:[o?e.jsx("form",{onSubmit:w,children:e.jsx("input",{type:"text",value:r,className:"focus:outline-accent-400/60 bg-charcoal-300/20 w-full rounded-md px-2 outline-0 focus:outline-2",onBlur:b,onChange:g,autoFocus:!0})}):e.jsx("p",{className:"cursor-pointer font-semibold",onClick:()=>{i(!0),m(!1),d(l.displayName)},children:l.displayName}),u?e.jsx("form",{onSubmit:w,children:e.jsx("input",{ref:s,type:"email",value:r,className:"focus:outline-accent-400/60 bg-charcoal-300/20 w-full rounded-md px-2 outline-0 focus:outline-2",onBlur:j,onChange:g,autoFocus:!0})}):e.jsx("p",{className:"text-cream/70 cursor-pointer",onClick:()=>{m(!0),i(!1),d(l.email??"")},children:l.email?l.email:"no email set"})]}),e.jsx(Q,{onClick:N,className:"cursor-pointer"})]})};export{oe as default};
