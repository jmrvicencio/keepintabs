import{d as S,b as V,u as $,r as i,j as e,f as F,e as B,R as I}from"./index-D63cc4uB.js";import{q as E,u as M,y as T,z as q,A as O}from"./firebase-wjis4Syq.js";import{v as R,P as G}from"./Panel-DVkFA_N1.js";import{c as _}from"./createLucideIcon-YKtzb1R1.js";import{X as z}from"./x-dbg4EVY4.js";import"./react-gH-7aFTg.js";/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]],X=_("user-round",K),H=p=>async(g,h)=>{try{const a=R(),n=p.uid,c=R(),d=E(S,`groups/${a}`),m=E(S,`groupMembers/${n}_${a}`),o=E(S,`groupSettings/${a}`),u={};for(let s of h){const b=R();u[b]=s}await M(o,{inviteKey:c}),await M(m,{userId:n,groupId:a,inviteKey:c}),M(d,{createdAt:T(),name:g,memberUids:[n],members:{[n]:{displayName:V.currentUser?.displayName,linkedUid:n},...u}}),await q(m,{inviteKey:O()});return}catch(a){throw a}},se=()=>{const p=$(),[r,g]=i.useState(""),[h,a]=i.useState(!1),[n,c]=i.useState(""),[d,m]=i.useState(""),[o,u]=i.useState([]),[s,b]=i.useState(!1),j=i.useRef(null),f=i.useRef(null),w=H(V.currentUser),N=async()=>{if(r==""){a(!0);return}s||(b(!0),await w(r,o),p(I.APP))},x=t=>{t.preventDefault(),N()},y=t=>{const l=t.target.value;g(l),a(l==="")},v=t=>{c(t.target.value)},D=t=>{m(t.target.value),f.current?.setCustomValidity("")},L=t=>{console.log("form enter"),t.preventDefault(),console.log("submitting form"),U()},U=()=>{const t={displayName:n};if(d!=""){if(A(d).length>0){f.current?.setCustomValidity("This email is already being used by another member"),f.current?.reportValidity(),f.current?.focus();return}t.email=d}u(l=>[...l,t]),m(""),c("")},P=t=>{const l=o.filter((C,k)=>k!=t);u(l)},A=(t,l=-1)=>o.filter((C,k)=>C.email!=""&&C.email?.toLowerCase()===t.toLowerCase()&&l!=k);return s?e.jsx(F,{}):e.jsx("div",{className:"relative flex w-full shrink-0 flex-col gap-8 p-3",children:e.jsxs("main",{className:"flex w-full flex-col",children:[e.jsxs("div",{className:"mb-4 flex w-full flex-row justify-between",children:[e.jsx(B,{to:I.APP,className:"left-0 cursor-pointer",children:e.jsx(G,{bgColor:"bg-accent-200",className:"text-ink-800 flex flex-row",dropOnClick:!0,children:"Cancel"})}),e.jsx("div",{className:"right-0 cursor-pointer",children:e.jsx(G,{onClick:N,bgColor:"bg-accent-200",className:"text-ink-800 flex flex-row",dropOnClick:!0,children:"Done"})})]}),e.jsx("h1",{className:"font-gieonto mt-4 text-left text-4xl font-medium",children:"Create Group"}),e.jsx("form",{onSubmit:x,children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-baseline justify-between py-2",children:[e.jsx("label",{htmlFor:"name",children:"Group Name"}),e.jsxs("p",{className:"text-xs",children:[r.length,"/32"]})]}),e.jsx("input",{id:"name",type:"text",autoComplete:"off",className:`${h&&"error"} peer [.error]:border-error border-charcoal-300 focus:outline-accent-400/60 [.error]:placeholder:text-error w-full rounded-md border bg-white px-2 py-1 focus:outline-2`,placeholder:h?"Group name is required":"Group Name",maxLength:32,value:r,onChange:y,autoFocus:!0})]})}),e.jsxs("div",{className:"relative my-4 pt-2 text-left",children:[e.jsx("h2",{className:"font-bold",children:"Add Members"}),e.jsx("p",{className:"mb-2 text-sm",children:"User will get a notification if the account exists"}),e.jsxs("form",{method:"submit",onSubmit:L,autoComplete:"off",className:"flex flex-col gap-2",ref:j,children:[e.jsxs("div",{className:"flex flex-row gap-2",children:[e.jsx("input",{id:"name",type:"text",className:"border-charcoal-300 focus:outline-accent-400/60 w-0 grow-2 rounded-md border bg-white px-2 py-1 focus:outline-2",placeholder:"Name",value:n,onChange:v}),e.jsx("input",{id:"email",ref:f,type:"email",className:"border-charcoal-300 focus:outline-accent-400/60 w-0 grow-3 rounded-md border bg-white px-2 py-1 not-focus:invalid:border-red-500 focus:outline-2",placeholder:"Email (optional)",value:d,onChange:D,required:!1})]}),e.jsx("button",{style:{display:"none"},type:"submit"}),e.jsx("div",{className:"w-fit",children:e.jsx(G,{bgColor:"bg-accent-200 [.inactive]:bg-ink-300",padding:"px-2 py-0.5",inactive:n=="",onClick:U,children:"Add Member"})})]}),e.jsx("div",{className:"mt-6 flex flex-col gap-2",children:o.map((t,l)=>e.jsx("div",{className:"rounded-lg border bg-white p-2",children:e.jsx(J,{id:l,member:t,onClick:()=>{P(l)},setMembers:u,findMembers:A})},l))})]})]})})},J=({id:p,member:r,onClick:g,setMembers:h,findMembers:a})=>{const[n,c]=i.useState(!1),[d,m]=i.useState(!1),[o,u]=i.useState(""),s=i.useRef(null),b=()=>{c(!1),f()},j=()=>{if(s.current?.setCustomValidity(""),s.current?.validity.valid==!1){s.current?.reportValidity(),s.current?.focus();return}else if(a(o,p).length>0){s.current?.setCustomValidity("This email is already being used by another member"),s.current?.reportValidity(),s.current?.focus();return}c(!1),m(!1),f()},f=()=>{h(x=>{const y=[...x],v={...y[p]};return y[p]=v,n?v.displayName=o:v.email=o,y})},w=x=>{x.preventDefault(),d?j():b()},N=x=>{s.current?.setCustomValidity(""),u(x.target.value)};return e.jsxs("div",{className:"border-ink-800 flex flex-row items-center gap-3 not-first:mt-2 not-first:border-t not-first:pt-4",children:[e.jsx(X,{className:"h-5 w-5"}),e.jsxs("div",{className:"flex grow flex-col",children:[n?e.jsx("form",{onSubmit:w,children:e.jsx("input",{type:"text",value:o,className:"focus:outline-accent-400/60 w-full rounded-md bg-white px-2 outline-0 focus:outline-2",onBlur:b,onChange:N,autoFocus:!0})}):e.jsx("p",{className:"cursor-pointer font-semibold",onClick:()=>{c(!0),m(!1),u(r.displayName)},children:r.displayName}),d?e.jsx("form",{onSubmit:w,children:e.jsx("input",{ref:s,type:"email",value:o,className:"focus:outline-accent-400/60 w-full rounded-md bg-white px-2 outline-0 focus:outline-2",onBlur:j,onChange:N,autoFocus:!0})}):e.jsx("p",{className:`${!r.email&&"empty"} text-ink-800/80 [.empty]:text-ink-400 cursor-pointer`,onClick:()=>{m(!0),c(!1),u(r.email??"")},children:r.email?r.email:"no email set"})]}),e.jsx(z,{onClick:g,className:"cursor-pointer"})]})};export{se as default};
